name: ğŸ”„ Daily Knowledge Hub Generator & Publisher

on:
  schedule:
    # Schedule the job to run once daily (00:00 UTC)
    - cron: '0 0 * * *' 
  workflow_dispatch:
    inputs:
      mode:
        description: 'SYSTEM_MODE: LIVE or TEST'
        required: true
        default: 'TEST' 
        type: choice
        options:
          - LIVE
          - TEST

jobs:
  generate_and_publish:
    runs-on: ubuntu-latest
    
    env:
      SYSTEM_MODE: ${{ github.event.inputs.mode || 'LIVE' }} 
      PUBLISHER_REPO_OWNER: ${{ github.repository_owner }} 
      PUBLISHER_REPO_NAME: knowledge-hub
      
    steps:
      - name: â¬‡ï¸ Checkout Factory Repo
        uses: actions/checkout@v4
        with:
          # Ø§Ø³ØªØ®Ø¯Ø§Ù… PAT Ù‡Ù†Ø§ ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù„Ø§Ø­Ù‚
          token: ${{ secrets.PUBLISH_PAT }} 
          
      - name: ğŸ—ï¸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: âš™ï¸ Set Git User for Commit
        run: |
          git config --global user.email "knowledgehub-bot@users.noreply.github.com"
          git config --global user.name "Knowledge Hub Automation Bot"

      - name: ğŸ“¦ Setup Publisher Structure (Crucial for generator.py path)
        run: |
          mkdir -p ../${{ env.PUBLISHER_REPO_NAME }}/content/posts/
          
      - name: ğŸš€ Run Generator Script
        # ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆÙŠÙ†ÙØ° git commit Ù„Ù‡Ø§
        run: python content-engine/generator.py
        env:
          SYSTEM_MODE: ${{ env.SYSTEM_MODE }} 
          
      - name: ğŸ›‘ Kill Switch Check (Skip Push if in TEST mode)
        if: env.SYSTEM_MODE == 'TEST'
        run: echo "SYSTEM_MODE is TEST. Skipping secure Git Push to Publisher."
        
      - name: ğŸ“¤ Secure Push Generated Content (LIVE Mode Only)
        if: env.SYSTEM_MODE == 'LIVE'
        run: |
          echo "Starting secure push to ${{ env.PUBLISHER_REPO_OWNER }}/${{ env.PUBLISHER_REPO_NAME }}"
          
          # ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¯ÙØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‡Ø¯Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ SSH/Git
          # Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ø®Ø·ÙˆØ© Checkout
          git push -f https://github.com/${{ env.PUBLISHER_REPO_OWNER }}/${{ env.PUBLISHER_REPO_NAME }}.git HEAD:main
